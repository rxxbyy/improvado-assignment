---
import Box from "@mui/material/Box";
import { SparkLineChart } from "@mui/x-charts/SparkLineChart";

const { title, amount, unit, data } = Astro.props;

function formatNumber(value: number | string): string {
    const num = typeof value === "string" ? parseFloat(value) : value;
    if (isNaN(num)) return String(value);

    if (num >= 1_000_000) {
        return `${(num / 1_000_000).toFixed(2)}M`;
    } else if (num >= 1_000) {
        return `${(num / 1_000).toFixed(2)}K`;
    }
    return num.toFixed(0);
}

function formatCurrency(value: number | string): string {
    return `$${formatNumber(value)}`;
}

let displayAmount;
if (unit === "%") {
    displayAmount = `${amount}%`;
} else if (unit === "$") {
    displayAmount = formatCurrency(amount);
} else {
    displayAmount = formatNumber(amount);
}
---

<div
    class="flex w-full h-40 md:h-52 lg:h-60 justify-center items-center flex-col p-3 bg-white rounded-lg shadow-sm"
>
    <header class="flex flex-col items-center justify-center">
        <p class="title text-gray-500">{title}</p>
        <h2 class="amount">{displayAmount}</h2>
    </header>
    <div class="w-full">
        <Box client:only="react" flexGrow={1}>
            <SparkLineChart client:only="react" data={data} height={80} />
        </Box>
    </div>
</div>

<style>
    .title {
        font-size: clamp(0.875rem, 1.5vw, 1.5rem);
    }
    .amount {
        font-size: clamp(1.25rem, 2.5vw, 2.25rem);
    }
</style>
